# Data

## ERA5 and trajectory calculations

We apply the aforementioned methodologies to the latest ERA5 data with $0.5^{\circ} \times 0.5^{\circ}$ horizontal resolution, 137 vertical coordinates expressed as model-levels and 3-hourly temporal resolution from 1980 to 2020. ERA5 data is model output that has been assimilated with observation and therefore represents the most complete global product of gridded meteorological data. Near-surface temperature is represented by 2m temperature and $T'$ is calculated using transient climatologies of 9-year centered windows of 21-day periods, at every model-level. A complete description of ERA5 products may be found in Hersbach et al. (2020). 

This thesis considers the final dataset in two ways: the first section will analyse the final decomposition of each TX1day event, while the second will analyse the timeseries that evolves when considering at each backward trajectory timestep the cumulative decomposition from genesis.

## Final decomposition 

The former may be considered as a budget since it represents the total T' accumulated over its trajectory. This yields an observational dataset containing - at every [latitude, longitude, year] index - the achieved T' magnitude and the three contributors corresponding to T' gained through advective, adiabatic and diabatic processes. Numerical residuals in \@ref(eq:tdecomp) due to finite difference approximations of a continuous temporal domain are usually small and thus ignored in future analysis. Furthermore, I assume that at a location [latitude, longitude], yearly samples are unaffected by local long-term temporal dependencies. Thus, for each location, the data consists in 41 independent draws from some multivariate distribution:

$$(T',\text{adv},\text{adiab},\text{diab}) \sim F $$
Initial exploration of the final decomposition shows a wide variety of marginal distributional behaviors, both for $T'$ and each contributors. Figure X shows locations with right-, left-skewed and bi-modal sample histograms as well as the non-linear and highly negatively correlated relationships between contributors and with $T'$. 

```{r flatdata, fig.cap="(a-c) Plots of TX1day T' against the three contributors and (e-f) pair-plots for the contributors for years 1980 to 2020 for three locations. The T' histogram is plotted on the top-right of the figure, and the contributor histograms with 8 bins are plotted below (e-f). The TX1day event acheiving largest T' is plotted as a diamond.", echo=FALSE, out.width="100%", fig.pos = 'h'}
knitr::include_graphics("images/flat_data.png")
```

## Trajectory timeseries

At every [latitude, longitude, year] index, the second dataset considers the time-cumulative evolution of the parcel's T', decomposed into the three contributors. Since each event may have a different genesis-time, all series are padded with zeros before their genesis time, yielding at each location 41 timeseries of length 121. The data displays again diverse structures, year-to-year as well as across space. Figure \@ref(fig:timeseriesdata) illustrates the year-to-year variability for one example. T' and the contributor T's all exhibit significant positive auto-correlations, decreasing at larger time-lags. The cross-correlation between T' and the contributor T's is also large. Furthermore, the graphs show some trajectories coupling and decoupling in time: for example, the largest TX1day T' event exhibits advective and diabatic T' both decreasing until about 2 days before the event, then the diabatic T' steeply increases while the advective T' continues to decrease after a brief increase. The same pattern is observed between adiabatic and diabtic T's - although with negative correlation - up to 2 days before and then only little association. 

```{r timeseriesdata, fig.cap="(a-d) Plots of TX1day T' decompositions at 16$^{\\circ}$S, 48$^{\\circ}$W (vicinity of Brazilia, Brazil) for years 1980 to 2020. The x-axis is logarithmic to better represent the recent history. The trajectory yielding the largest final T' among all years is colored red, the time-mean of all trajectories in black and the inter-quantile range is highlighted in light blue. The average auto-correlation (e) and cross-correlation with T' (f) over all events for each contributor. The auto- and cross-correlation are computed for timeseries starting at genesis (ignoring padding) and timeseries that are smaller than 32 timesteps are not included in the averages for lags larger than their length.", echo=FALSE, out.width="100%", fig.pos = 'h'}
knitr::include_graphics("images/timeseries_data.png")
```